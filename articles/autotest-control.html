<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="autotest">
<title>Control of tests • autotest</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Control of tests">
<meta property="og:description" content="autotest">
<meta property="og:image" content="https://docs.ropensci.org/autotest/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">autotest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.2.207</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/autotest.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/autotest-control.html">Control of tests</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci-review-tools/autotest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Control of tests</h1>
                        <h4 data-toc-skip class="author">Mark Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-03-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/autotest/blob/HEAD/vignettes/autotest-control.Rmd" class="external-link"><code>vignettes/autotest-control.Rmd</code></a></small>
      <div class="d-none name"><code>autotest-control.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://docs.ropensci.org/autotest/articles/autotest.html">first vignette</a> demonstrates the process of applying <code>autotest</code> at all stages of package development. This vignette provides additional information for those applying <code>autotest</code> to already developed packages, in particular through describing how tests can be selectively applied to a package. By default the <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code> function</a> tests an entire package, but testing can also be restricted to specified functions only. This vignette will demonstrate application to a few functions from the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html" class="external-link"><code>stats</code> package</a>, starting by loading the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/autotest/">autotest</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="rd-files-example-code-and-the-autotest-workflow">1. <code>.Rd</code> files, example code, and the autotest workflow<a class="anchor" aria-label="anchor" href="#rd-files-example-code-and-the-autotest-workflow"></a>
</h2>
<p>To understand what <code>autotest</code> does, it is first necessary to understand a bit about the structure of documentation files for R package, which are contained in files called <code>".Rd"</code> files. Tests are constructed by parsing individual <code>.Rd</code> documentation files to extract the example code, identifying parameters passed to the specified functions, and mutating those parameters.</p>
<p>The general procedure can be illustrated by examining a specific function, for which we now choose the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cor.html" class="external-link"><code>cor</code> function</a>, because of its relative simplicity. The following lines extract the documentation for the <code>cor</code> function, a <code>.html</code> version of which can be seen by clicking on the link above. Note that that web page reveals the name of the <code>.Rd</code> file to be “cor” (in the upper left corner), meaning that the name of the <code>.Rd</code> file is <code>"cor.Rd"</code>. The following lines extract that content, first by loading the entire <code>.Rd</code> database for the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html" class="external-link"><code>stats</code> package</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rd</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/Rdutils.html" class="external-link">Rd_db</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span><span class="op">)</span></span>
<span><span class="va">cor_rd</span> <span class="op">&lt;-</span> <span class="va">rd</span> <span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span> <span class="op">(</span><span class="st">"^cor\\.Rd"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="va">rd</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>The database itself is a list, with each entry holding the contents of one <code>.Rd</code> file in an object of class Rd, which is essentially a large nested list of components corresponding to the various <code>.Rd</code> tags such as <code>\arguments</code>, <code>\details</code>, and <code>\value</code>. An internal function from the <a href="https://stat.ethz.ch/R-manual/R-devel/library/tools/html/00Index.html" class="external-link"><code>tools</code> package</a> can be used to extract individual components (using the <code>:::</code> notation to access internal functions). For example, a single <code>.Rd</code> file often describes the functionality of several functions, each of which is identified by specifying the function name as an <code>"alias"</code>. The aliases for the <code>"cor.Rd"</code> file are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">:::</span><span class="fu">.Rd_get_metadata</span> <span class="op">(</span><span class="va">cor_rd</span>, <span class="st">"alias"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "var"     "cov"     "cor"     "cov2cor"</span></span></code></pre></div>
<p>This one file thus contains documentation for those four functions. Example code can be extracted with a dedicated function from the <a href="https://stat.ethz.ch/R-manual/R-devel/library/tools/html/Rd2HTML.html" class="external-link"><code>tools</code> package</a>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/Rd2HTML.html" class="external-link">Rd2ex</a></span> <span class="op">(</span><span class="va">cor_rd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; ### Name: cor</span></span>
<span><span class="co">#&gt; ### Title: Correlation, Variance and Covariance (Matrices)</span></span>
<span><span class="co">#&gt; ### Aliases: var cov cor cov2cor</span></span>
<span><span class="co">#&gt; ### Keywords: univar multivariate array</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### ** Examples</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; var(1:10)  # 9.166667</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; var(1:5, 1:5) # 2.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Two simple vectors</span></span>
<span><span class="co">#&gt; cor(1:10, 2:11) # == 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Correlation Matrix of Multivariate sample:</span></span>
<span><span class="co">#&gt; (Cl &lt;- cor(longley))</span></span>
<span><span class="co">#&gt; ## Graphical Correlation Matrix:</span></span>
<span><span class="co">#&gt; symnum(Cl) # highly correlated</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Spearman's rho  and  Kendall's tau</span></span>
<span><span class="co">#&gt; symnum(clS &lt;- cor(longley, method = "spearman"))</span></span>
<span><span class="co">#&gt; symnum(clK &lt;- cor(longley, method = "kendall"))</span></span>
<span><span class="co">#&gt; ## How much do they differ?</span></span>
<span><span class="co">#&gt; i &lt;- lower.tri(Cl)</span></span>
<span><span class="co">#&gt; cor(cbind(P = Cl[i], S = clS[i], K = clK[i]))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## cov2cor() scales a covariance matrix by its diagonal</span></span>
<span><span class="co">#&gt; ##           to become the correlation matrix.</span></span>
<span><span class="co">#&gt; cov2cor # see the function definition {and learn ..}</span></span>
<span><span class="co">#&gt; stopifnot(all.equal(Cl, cov2cor(cov(longley))),</span></span>
<span><span class="co">#&gt;           all.equal(cor(longley, method = "kendall"),</span></span>
<span><span class="co">#&gt;             cov2cor(cov(longley, method = "kendall"))))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ##--- Missing value treatment:</span></span>
<span><span class="co">#&gt; C1 &lt;- cov(swiss)</span></span>
<span><span class="co">#&gt; range(eigen(C1, only.values = TRUE)$values) # 6.19        1921</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## swM := "swiss" with  3 "missing"s :</span></span>
<span><span class="co">#&gt; swM &lt;- swiss</span></span>
<span><span class="co">#&gt; colnames(swM) &lt;- abbreviate(colnames(swiss), minlength=6)</span></span>
<span><span class="co">#&gt; swM[1,2] &lt;- swM[7,3] &lt;- swM[25,5] &lt;- NA # create 3 "missing"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Consider all 5 "use" cases :</span></span>
<span><span class="co">#&gt; (C. &lt;- cov(swM)) # use="everything"  quite a few NA's in cov.matrix</span></span>
<span><span class="co">#&gt; try(cov(swM, use = "all")) # Error: missing obs...</span></span>
<span><span class="co">#&gt; C2 &lt;- cov(swM, use = "complete")</span></span>
<span><span class="co">#&gt; stopifnot(identical(C2, cov(swM, use = "na.or.complete")))</span></span>
<span><span class="co">#&gt; range(eigen(C2, only.values = TRUE)$values) # 6.46   1930</span></span>
<span><span class="co">#&gt; C3 &lt;- cov(swM, use = "pairwise")</span></span>
<span><span class="co">#&gt; range(eigen(C3, only.values = TRUE)$values) # 6.19   1938</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Kendall's tau doesn't change much:</span></span>
<span><span class="co">#&gt; symnum(Rc &lt;- cor(swM, method = "kendall", use = "complete"))</span></span>
<span><span class="co">#&gt; symnum(Rp &lt;- cor(swM, method = "kendall", use = "pairwise"))</span></span>
<span><span class="co">#&gt; symnum(R. &lt;- cor(swiss, method = "kendall"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## "pairwise" is closer componentwise,</span></span>
<span><span class="co">#&gt; summary(abs(c(1 - Rp/R.)))</span></span>
<span><span class="co">#&gt; summary(abs(c(1 - Rc/R.)))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## but "complete" is closer in Eigen space:</span></span>
<span><span class="co">#&gt; EV &lt;- function(m) eigen(m, only.values=TRUE)$values</span></span>
<span><span class="co">#&gt; summary(abs(1 - EV(Rp)/EV(R.)) / abs(1 - EV(Rc)/EV(R.)))</span></span></code></pre>
<p>This is the entire content of the <code>\examples</code> portion of <code>"cor.Rd"</code>, as can be confirmed by comparing with the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cor.html" class="external-link">online version</a>.</p>
</div>
<div class="section level2">
<h2 id="internal-structure-of-the-autotest-workflow">2. Internal structure of the <code>autotest</code> workflow<a class="anchor" aria-label="anchor" href="#internal-structure-of-the-autotest-workflow"></a>
</h2>
<p>For each <code>.Rd</code> file in a package, <code>autotest</code> tests the code given in the example section according to the following general steps:</p>
<ol style="list-style-type: decimal">
<li>Extract example lines from the <code>.Rd</code> file, as demonstrated above;</li>
<li>Identify all function <code>aliases</code> described by that file;</li>
<li>Identify all points at which those functions are called;</li>
<li>Identify all objects passed to those values, including values, classes, attributes, and other properties.</li>
<li>Identify any other parameters not explicitly passed in example code, but defined via default value;</li>
<li>Mutate the values of all parameters according to the kinds of test described in <a href="https://docs.ropensci.org/autotest/reference/autotest_types.html"><code>autotest_types()</code></a>.</li>
</ol>
<p>Calling <code>autotest_package(..., test = FALSE)</code> implements the first 5 of those 6 steps, and returns data on all possible mutations of each parameter, while setting <code>test = TRUE</code> actually passes the mutated parameters to the specified functions, and returns reports on any unexpected behaviour.</p>
</div>
<div class="section level2">
<h2 id="autotest-ing-the-statscov-function">3. <code>autotest</code>-ing the <code>stats::cov</code> function<a class="anchor" aria-label="anchor" href="#autotest-ing-the-statscov-function"></a>
</h2>
<p>The preceding sections describe how <code>autotest</code> actually works, while the present section demonstrates how the package is typically used in practice. As demonstrated in the <a href="https://docs.ropensci.org/autotest/"><code>README</code></a>, information on all tests implemented within the package can be obtained by calling the <a href="https://docs.ropensci.org/autotest/reference/autotest_types.html"><code>autotest_types()</code> function</a>. The main function for testing package is <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a>. The nominated package can be either an installed package, or the full path to a local directory containing a package’s source code. By default all <code>.Rd</code> files of a package are tested, with restriction to specified functions possible either by nominating functions to exclude from testing (via the <code>exclude</code> parameter), or functions to include (via the <code>functions</code> parameter). The <code>functions</code> parameter is intended to enable testing only of specified functions, while the <code>exclude</code> parameter is intended to enable testing of all functions except those specified with this parameter. Specifying values for both of these parameters is not generally recommended.</p>
<div class="section level3">
<h3 id="listing-tests-without-conducting-them">3.1 Listing tests without conducting them<a class="anchor" aria-label="anchor" href="#listing-tests-without-conducting-them"></a>
</h3>
<p>The following demonstrates the results of <code>autotest</code>-ing the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cor.html" class="external-link"><code>cor</code> function</a> of the <code>stats</code> package, noting that the default call uses <code>test = FALSE</code>, and so returns details of all tests without actually implementing them (and for this reason we name the object <code>xf</code> for “false”):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>, functions <span class="op">=</span> <span class="st">"cor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">xf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 8</span></span></span>
<span><span class="co">#&gt;    type  test_name      fn_name parameter parameter_type operation content test </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> dummy single_char_c… cor     use       single_charac… lower-ca… (Shoul… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> dummy single_char_c… cor     use       single_charac… upper-ca… (Shoul… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> dummy single_par_as… cor     use       single_charac… Length 2… Should… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> dummy return_succes… cor     (return … (return objec… Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> dummy return_val_de… cor     (return … (return objec… Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> dummy return_desc_i… cor     (return … (return objec… Check wh… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> dummy return_class_… cor     (return … (return objec… Compare … <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> dummy par_is_docume… cor     x         <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> dummy par_matches_d… cor     x         <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> dummy par_is_docume… cor     use       <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> dummy par_matches_d… cor     use       <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> dummy par_is_docume… cor     method    <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> dummy par_matches_d… cor     method    <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> dummy par_is_docume… cor     y         <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> dummy par_matches_d… cor     y         <span style="color: #BB0000;">NA</span>             Check th… <span style="color: #BB0000;">NA</span>      TRUE</span></span></code></pre>
<p>The object returned from <code><a href="../reference/autotest_package.html">autotest_package()</a></code> is a simple <a href="https://tibble.tidyverse.org" class="external-link"><code>tibble</code></a>, with each row detailing one test which would be applied to the each of the listed functions and parameters. Because no tests were conducted, all tests will generally have a <code>type</code> of <code>"dummy"</code>. In this case, however, we see the following:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span> <span class="op">(</span><span class="va">xf</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; dummy </span></span>
<span><span class="co">#&gt;    15</span></span></code></pre></div>
<p>In addition to the 15 dummy tests, the function also returns 0 warnings, the corresponding rows of which are:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xf</span> <span class="op">[</span><span class="va">xf</span><span class="op">$</span><span class="va">type</span> <span class="op">!=</span> <span class="st">"dummy"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"fn_name"</span>, <span class="st">"parameter"</span>, <span class="st">"operation"</span>, <span class="st">"content"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: fn_name &lt;chr&gt;, parameter &lt;chr&gt;, operation &lt;chr&gt;, content &lt;chr&gt;</span></span></span></code></pre></div>
<p>Although the <code>auotest</code> package is primarily intended to apply mutation tests to all parameters of all functions of a package, doing so requires identifying parameter types and classes through parsing example code. Any parameters of a function which are neither demonstrated within example code, nor given default values can not be tested, because it is not possible to determine their expected types. The above result reveals that neither the <code>use</code> parameter of the <code>var</code> function, nor the <code>y</code> parameter of <code>cov</code>, are demonstrated in example code, triggering a warning that these parameter are unable to be tested.</p>
</div>
<div class="section level3">
<h3 id="conducting-tests">3.2 Conducting tests<a class="anchor" aria-label="anchor" href="#conducting-tests"></a>
</h3>
<p>The 15 tests listed above with <code>type == "dummy"</code> can then be applied to all nominated functions and parameters by calling the same function with <code>test = TRUE</code>. Doing so yields the following results (as an object names <code>xt</code> for “true”):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>,</span>
<span>                        functions <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                        test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">xt</span><span class="op">)</span></span></code></pre></div>
<p>And the 15 tests yielded 5 unexpected responses. The best way to understand these results is to examine the object in detail, typically through <code>edit(xt)</code>, or equivalently in RStudio, clicking on the listed object. The different types of tests which produced unexpected responses were:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span> <span class="op">(</span><span class="va">xt1</span><span class="op">$</span><span class="va">operation</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Check that documentation matches class of input parameter </span></span>
<span><span class="co">#&gt;                                                         4 </span></span>
<span><span class="co">#&gt;                            upper-case character parameter </span></span>
<span><span class="co">#&gt;                                                         1</span></span></code></pre></div>
<p>Two of those reflect the previous results regarding parameters unable to be tested, while the remainder come from only two types of tests. Information on the precise results is contained in the <code>content</code> column, although in this case it is fairly straightforward to see that the operation “upper case character parameter” arises because the <code>use</code> and <code>method</code> parameters of the <code>cor</code> and <code>cov</code> functions are case-dependent, and are only accepted in lower case form. The other operation is the conversion of vectors to list-column format, as described in the <a href="https://docs.ropensci.org/autotest/articles/autotest.html">first vignette</a>.</p>
</div>
<div class="section level3">
<h3 id="controlling-which-tests-are-conducted">3.4 Controlling which tests are conducted<a class="anchor" aria-label="anchor" href="#controlling-which-tests-are-conducted"></a>
</h3>
<p>The <code>test</code> parameter of the <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code> function</a> can be used to control whether all tests are conducted or not. Finer-level control over tests can be achieved by specifying the <code>test_data</code> parameter. This parameter must be an object of class <code>autotest_package</code>, as returned by either the <a href="https://docs.ropensci.org/autotest/reference/autotest_types.html"><code>autotest_types()</code></a>] or <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a> functions. The former of these is the function which specifies all unique tests, and so returns a relatively small <code>tibble</code> of 27 rows. The following lines demonstrate how to switch off the list-column test for all functions and parameters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">types</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_types.html">autotest_types</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">types</span><span class="op">$</span><span class="va">test</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span> <span class="op">(</span><span class="st">"list_col"</span>, <span class="va">types</span><span class="op">$</span><span class="va">test_name</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">xt2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>,</span>
<span>                         functions <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                         test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         test_data <span class="op">=</span> <span class="va">types</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">xt2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   type       test_name  fn_name parameter parameter_type operation content test </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> warning    par_match… cor     x         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> warning    par_match… cor     y         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> warning    par_match… cor     x         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> warning    par_match… cor     y         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> diagnostic single_ch… cor     use       single charac… upper-ca… is cas… TRUE</span></span></code></pre>
<p>The result now has four rows with <code>test == FALSE</code>, and <code>type == "no_test"</code>, indicating that these tests were not actually conducted. That also makes apparent the role of these <code>test</code> flags. When initially calling <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a> with default <code>test = FALSE</code>, the result contains a <code>test</code> column in which all values are <code>TRUE</code>. Although potentially perplexing at first, this value must be understood in relation to the <code>type</code> column. A <code>type</code> of <code>"dummy"</code> indicates that a test has not been conducted, in which case <code>test = TRUE</code> is a control flag used to determine what would be conducted if these data were submitted as the <code>test_data</code> parameter. For all <code>type</code> values other than <code>"dummy"</code>, the <code>test</code> column specifies whether or not each test was actually conducted.</p>
<p>The preceding example showed how the results of <a href="https://docs.ropensci.org/autotest/reference/autotest_types.html"><code>autotest_types()</code></a> can be used to control which tests are implemented for an entire package. Finer-scale control can be achieved by modifying individual rows of the full table returned by <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a>. The following code demonstrates by showing how list-column tests can be switched off only for particular functions, starting again with the <code>xf</code> data of dummy tests generated above.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>,</span>
<span>                        functions <span class="op">=</span> <span class="st">"cor"</span><span class="op">)</span></span>
<span><span class="va">xf</span><span class="op">$</span><span class="va">test</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span> <span class="op">(</span><span class="st">"list_col"</span>, <span class="va">xf</span><span class="op">$</span><span class="va">test_name</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">xf</span><span class="op">$</span><span class="va">fn_name</span> <span class="op">==</span> <span class="st">"var"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">xt3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>,</span>
<span>                         functions <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                         test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         test_data <span class="op">=</span> <span class="va">xf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="va">xt3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   type       test_name  fn_name parameter parameter_type operation content test </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> warning    par_match… cor     x         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> warning    par_match… cor     y         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> warning    par_match… cor     x         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> warning    par_match… cor     y         <span style="color: #BB0000;">NA</span>             Check th… Parame… TRUE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> diagnostic single_ch… cor     use       single charac… upper-ca… is cas… TRUE</span></span></code></pre>
<p>These procedures illustrate the three successively finer levels of control over tests, by switching them off for:</p>
<ol style="list-style-type: decimal">
<li>Entire packages;</li>
<li>Specified functions only; or</li>
<li>Specific parameters of particular functions only.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="autotest-ing-your-package">4. <code>autotest</code>-ing your package<a class="anchor" aria-label="anchor" href="#autotest-ing-your-package"></a>
</h2>
<p><code>autotest</code> can be very easily incorporated in your package’s <code>tests/</code> directory via to simple <a href="https://testthat.r-lib.org" class="external-link"><code>testthat</code></a> expectations:</p>
<ul>
<li>
<code>expect_autotest_no_testdata</code>, which will expect <code>autotest_package</code> to work on your package with default values including no additional <code>test_data</code> specifying tests which are not to be run; or</li>
<li>
<code>expect_autotest_testdata</code>, to be used when specific tests are switched off.</li>
</ul>
<p>Using these requires adding <code>autotest</code> to the <code>Suggests</code> list of your package’s <code>DESCRIPTION</code> file, along with <code>testthat</code>. Note that the use of testing frameworks other than <a href="https://testthat.r-lib.org" class="external-link"><code>testthat</code></a> is possible through writing custom expectations for the output of <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a>, but that is not considered here.</p>
<p>To use these expectations, you must first decide which, if any, tests you judge to be not applicable to your package, and switch them off following the procedure described above (that is, at the package level through modifying the <code>test</code> flag of the object returned from <a href="https://docs.ropensci.org/autotest/reference/autotest_types.html"><code>autotest_types()</code></a>, or at finer function- or parameter-levels by modifying equivalent values in the object returned from <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package(..., test = FALSE)</code></a>. These objects must then be passed as the <code>test_data</code> parameter to <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a>. If you consider all tests to be applicable, then <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a> can be called without specifying this parameter.</p>
<p>If you switch tests off via a <code>test_data</code> parameter, then the <code>expect_autotest</code> expectation requires you to append an additional column to the <code>test_data</code> object called <code>"note"</code> (case-insensitive), and include a note for each row which has <code>test = FALSE</code> explaining why those tests have been switched off. Lines in your test directory should look something like this:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span> <span class="co"># as called in your test suite</span></span>
<span><span class="co"># For example, to switch off vector-to-list-column tests:</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_types.html">autotest_types</a></span> <span class="op">(</span>notest <span class="op">=</span> <span class="st">"vector_to_list_col"</span><span class="op">)</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">note</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">note</span> <span class="op">[</span><span class="va">test_data</span><span class="op">$</span><span class="va">test</span> <span class="op">==</span> <span class="st">"vector_to_list_col"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="st">"These tests are not applicable because ..."</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_success</a></span> <span class="op">(</span><span class="fu"><a href="../reference/expect_autotest_testdata.html">expect_autotest_testdata</a></span> <span class="op">(</span><span class="va">test_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This procedure of requiring an additional <code>"note"</code> column ensures that your own test suite will explicitly include all explanations of why you deem particular tests not to be applicable to your package.</p>
<p>In contrast, the following expectation should be used when <code><a href="../reference/autotest_package.html">autotest_package()</a></code> passes with all tests are implemented, in which case no parameters need be passed to the expectation, and tests will confirm that no warnings or errors are generated.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_success</a></span> <span class="op">(</span><span class="fu"><a href="../reference/expect_autotest_no_testdata.html">expect_autotest_no_testdata</a></span> <span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="finer-control-over-testing-expectations">4.2 Finer control over testing expectations<a class="anchor" aria-label="anchor" href="#finer-control-over-testing-expectations"></a>
</h3>
<p>The two expectations shown above call the <a href="https://docs.ropensci.org/autotest/reference/autotest_package.html"><code>autotest_package()</code></a> function internally, and assert that the results follow the expected pattern. There are also three additional <a href="https://testthat.r-lib.org" class="external-link"><code>testthat</code></a> expectations which can be applied to pre-generated <code>autotest</code> objects, to allow for finer control over testing expectations. These are:</p>
<ul>
<li>
<code>expect_autotest_no_err</code> to expect no errors in results from <code><a href="../reference/autotest_package.html">autotest_package()</a></code>;</li>
<li>
<code>expect_autotest_no_warn</code> to expect no warnings; and</li>
<li>
<code>expect_autotest_notes</code> to expect tests which have been switched off to have an additional <code>"note"</code> column explaining why.</li>
</ul>
<p>These tests are demonstrated in one of the testing files used in this package, which the following lines recreate to demonstrate the general process. The first two expectations are that an object be free from both warnings and errors. The tests implemented here are applied to the <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/cor.html" class="external-link"><code>stats::cov()</code> function</a>, which actually triggers warnings because two parameters do not have their usage demonstrated in the example code. The tests therefore <code><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_failure()</a></code>, when they generally should <code><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_success()</a></code> throughout.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span> <span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span> <span class="co"># as called in your test suite</span></span>
<span><span class="co"># For example, to switch off vector-to-list-column tests:</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_types.html">autotest_types</a></span> <span class="op">(</span>notest <span class="op">=</span> <span class="st">"vector_to_list_col"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autotest_package.html">autotest_package</a></span> <span class="op">(</span>package <span class="op">=</span> <span class="st">"stats"</span>,</span>
<span>                       functions <span class="op">=</span> <span class="st">"cov"</span>,</span>
<span>                       test <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       test_data <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span>
<span>       </span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_success</a></span> <span class="op">(</span><span class="fu"><a href="../reference/expect_autotest_no_err.html">expect_autotest_no_err</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_failure</a></span> <span class="op">(</span><span class="fu"><a href="../reference/expect_autotest_no_warn.html">expect_autotest_no_warn</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="co"># should expect_success!!</span></span></code></pre></div>
<p>The test files then affirms that simply passing the object, <code>x</code>, which has tests flagged as <code>type == "no_test"</code>, yet without explaining why in an additional <code>"note"</code> column, should cause <code>expect_autotest()</code> to fail. The following line, removing the logical <code>testthat</code> expectation, demonstrates:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/expect_autotest_notes.html">expect_autotest_notes</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>As demonstrated above, these <code>expect_autotest_...</code> calls should always be wrapped in a direct <a href="https://testthat.r-lib.org" class="external-link"><code>testhat</code></a> expectation of <a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link"><code>expect_success()</code></a>. To achieve success in that case, we need to append an additional <code>"note"</code> column containing explanations of why each test has been switched off:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">note</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="va">x</span> <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span> <span class="op">(</span><span class="st">"vector_to_list"</span>, <span class="va">x</span><span class="op">$</span><span class="va">test_name</span><span class="op">)</span>, <span class="st">"note"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"these tests have been switched off because ..."</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_success.html" class="external-link">expect_success</a></span> <span class="op">(</span><span class="fu"><a href="../reference/expect_autotest_notes.html">expect_autotest_notes</a></span> <span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In general, using <code>autotest</code> in a package’s test suite should be as simple as adding <code>autotest</code> to <code>Suggests</code>, and wrapping either <code>expect_autotest_no_testdata</code> or <code>expect_autotest_testdata</code> in an <code>expect_success</code> call.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
